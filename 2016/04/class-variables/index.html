<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Class Variables | Libelli</title><meta name=keywords content><meta name=description content="These snippets are just a short reminder of how class variables work in Python. I understand this topic a bit too well, I think; I always remember the gotchas and can&rsquo;t remember which gotcha belongs to which important detail. I generally come up with the right answer then convince myself I&rsquo;m wrong until I write a bit of code and experiment. Hopefully this snippet will shortcut that process.
Consider the following class hierarchy:"><meta name=author content="Benjamin Bengfort"><link rel=canonical href=https://bbengfort.github.io/2016/04/class-variables/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d0c0348c2d0cff14148d0e347258519d8df2ce53ce5ac32c7bd9a549182cb8ae.css integrity="sha256-0MA0jC0M/xQUjQ40clhRnY3yzlPOWsMse9mlSRgsuK4=" rel="preload stylesheet" as=style><link rel=preload href=/icon.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://bbengfort.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bbengfort.github.io/icon.png><link rel=icon type=image/png sizes=32x32 href=https://bbengfort.github.io/icon.png><link rel=apple-touch-icon href=https://bbengfort.github.io/apple-touch-icon-precomposed.png><link rel=mask-icon href=https://bbengfort.github.io/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-8096804-11','auto');ga('send','pageview');}</script><meta property="og:title" content="Class Variables"><meta property="og:description" content="These snippets are just a short reminder of how class variables work in Python. I understand this topic a bit too well, I think; I always remember the gotchas and can&rsquo;t remember which gotcha belongs to which important detail. I generally come up with the right answer then convince myself I&rsquo;m wrong until I write a bit of code and experiment. Hopefully this snippet will shortcut that process.
Consider the following class hierarchy:"><meta property="og:type" content="article"><meta property="og:url" content="https://bbengfort.github.io/2016/04/class-variables/"><meta property="og:image" content="https://bbengfort.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-04-04T19:52:46+00:00"><meta property="article:modified_time" content="2016-04-04T19:52:46+00:00"><meta property="og:site_name" content="Libelli"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bbengfort.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Class Variables"><meta name=twitter:description content="These snippets are just a short reminder of how class variables work in Python. I understand this topic a bit too well, I think; I always remember the gotchas and can&rsquo;t remember which gotcha belongs to which important detail. I generally come up with the right answer then convince myself I&rsquo;m wrong until I write a bit of code and experiment. Hopefully this snippet will shortcut that process.
Consider the following class hierarchy:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://bbengfort.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Class Variables","item":"https://bbengfort.github.io/2016/04/class-variables/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Class Variables","name":"Class Variables","description":"These snippets are just a short reminder of how class variables work in Python. I understand this topic a bit too well, I think; I always remember the gotchas and can\u0026rsquo;t remember which gotcha belongs to which important detail. I generally come up with the right answer then convince myself I\u0026rsquo;m wrong until I write a bit of code and experiment. Hopefully this snippet will shortcut that process.\nConsider the following class hierarchy:","keywords":[],"articleBody":"These snippets are just a short reminder of how class variables work in Python. I understand this topic a bit too well, I think; I always remember the gotchas and can’t remember which gotcha belongs to which important detail. I generally come up with the right answer then convince myself I’m wrong until I write a bit of code and experiment. Hopefully this snippet will shortcut that process.\nConsider the following class hierarchy:\nfrom itertools import count class Foo(object): counter = count() def __init__(self): self.id = self.counter.next() def __str__(self): return \"{} {}\".format(self.__class__.__name__, self.id) class Bar(Foo): pass class Baz(Bar): pass Every instance of Foo will be assigned a unique, automatically incrementing id using the count iterator for itertools. The thing to remember is that Bar and Baz are also instances of Foo:\n isinstance(Baz(), Foo) True Keep that in mind given the following code:\n import random  things = (Foo, Bar, Baz)  for _ in xrange(10): ... print random.choice(things)() What is the expected result? If you said something like as follows:\nBar 0 Baz 1 Foo 2 Baz 3 Foo 4 Bar 5 Bar 6 Bar 7 Foo 8 Bar 9 Then you’re on the right track.\nThe problem is that the code above is typically not what is meant by programmers. And while I typically come to the conclusion that what I’m actually expressing by the above code is counting instances of Foo, what I actually want to do is count instances of each class (how many of each Foo, Bar, and Baz).\nThen I realize … oh crap, I’ve strayed into metaprogramming land. And that’s why I need the reminder of this post. I definitely get that I need a metaclass to make subclass counters work as expected, but I never remember exactly how to do it. So here’s how.\nclass Countable(type): def __new__(cls, name, bases, attrs): attrs['counter'] = count() return super(Countable, cls).__new__(cls, name, bases, attrs) class Foo(object): __metaclass__ = Countable Basically, what we’ve done here is is told the Foo class that it should be constructed using Countable instead of type. When the class is created, therefore it is given the class attribute counter. Now the output is as follows:\nFoo 0 Bar 0 Foo 1 Baz 0 Bar 1 Foo 2 Foo 3 Foo 4 Baz 1 Foo 5 This post isn’t about a long discussion on the metaclass in Python or how type is a subclass of type, but simply serves as a reminder for the very rare occasion that I have to rock something other than type. For more information on the subject, a very nice write-up, A Primer on Python Metaclasses by @jakevdp is the way to go.\n","wordCount":"446","inLanguage":"en","datePublished":"2016-04-04T19:52:46Z","dateModified":"2016-04-04T19:52:46Z","author":{"@type":"Person","name":"Benjamin Bengfort"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bbengfort.github.io/2016/04/class-variables/"},"publisher":{"@type":"Organization","name":"Libelli","logo":{"@type":"ImageObject","url":"https://bbengfort.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: #1d1e20;--entry: #2e2e33;--primary: rgba(255, 255, 255, 0.84);--secondary: rgba(255, 255, 255, 0.56);--tertiary: rgba(255, 255, 255, 0.16);--content: rgba(255, 255, 255, 0.74);--hljs-bg: #2e2e33;--code-bg: #37383e;--border: #333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://bbengfort.github.io accesskey=h title="Libelli (Alt + H)"><img src=/icon.png alt=logo aria-label=logo height=35>Libelli</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bbengfort.github.io/archive/ title=archive><span>archive</span></a></li><li><a href=https://bbengfort.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bbengfort.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://bbengfort.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Class Variables</h1><div class=post-meta>April 4, 2016&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Benjamin Bengfort</div></header><div class=post-content><p>These snippets are just a short reminder of how class variables work in Python. I understand this topic a bit too well, I think; I always remember the gotchas and can&rsquo;t remember which gotcha belongs to which important detail. I generally come up with the right answer then convince myself I&rsquo;m wrong until I write a bit of code and experiment. Hopefully this snippet will shortcut that process.</p><p>Consider the following class hierarchy:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> itertools <span style=color:#f92672>import</span> count


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Foo</span>(object):

    counter <span style=color:#f92672>=</span> count()

    <span style=color:#66d9ef>def</span> __init__(self):
        self<span style=color:#f92672>.</span>id <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>counter<span style=color:#f92672>.</span>next()

    <span style=color:#66d9ef>def</span> __str__(self):
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;{} {}&#34;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, self<span style=color:#f92672>.</span>id)


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bar</span>(Foo):
    <span style=color:#66d9ef>pass</span>


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Baz</span>(Bar):
    <span style=color:#66d9ef>pass</span>
</code></pre></div><p>Every instance of <code>Foo</code> will be assigned a unique, automatically incrementing id using the <code>count</code> iterator for <code>itertools</code>. The thing to remember is that <code>Bar</code> and <code>Baz</code> are <em>also</em> instances of <code>Foo</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> isinstance(Baz(), Foo)
True
</code></pre></div><p>Keep that in mind given the following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>import</span> random
<span style=color:#f92672>&gt;&gt;&gt;</span> things <span style=color:#f92672>=</span> (Foo, Bar, Baz)
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>10</span>):
<span style=color:#f92672>...</span>     <span style=color:#66d9ef>print</span> random<span style=color:#f92672>.</span>choice(things)()
</code></pre></div><p>What is the expected result? If you said something like as follows:</p><pre><code>Bar 0
Baz 1
Foo 2
Baz 3
Foo 4
Bar 5
Bar 6
Bar 7
Foo 8
Bar 9
</code></pre><p>Then you&rsquo;re on the right track.</p><p>The problem is that the code above is typically not what is meant by programmers. And while I typically come to the conclusion that what I&rsquo;m actually expressing by the above code is counting instances of <code>Foo</code>, what I actually want to do is count instances of each class (how many of each <code>Foo</code>, <code>Bar</code>, and <code>Baz</code>).</p><p>Then I realize &mldr; oh crap, I&rsquo;ve strayed into metaprogramming land. And that&rsquo;s why I need the reminder of this post. I definitely get that I need a metaclass to make subclass counters work as expected, but I never remember exactly how to do it. So here&rsquo;s how.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Countable</span>(type):

    <span style=color:#66d9ef>def</span> __new__(cls, name, bases, attrs):
        attrs[<span style=color:#e6db74>&#39;counter&#39;</span>] <span style=color:#f92672>=</span> count()
        <span style=color:#66d9ef>return</span> super(Countable, cls)<span style=color:#f92672>.</span>__new__(cls, name, bases, attrs)


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Foo</span>(object):

    __metaclass__ <span style=color:#f92672>=</span> Countable
</code></pre></div><p>Basically, what we&rsquo;ve done here is is told the Foo class that it should be constructed using <code>Countable</code> instead of <code>type</code>. When the <em>class</em> is created, therefore it is given the class attribute <code>counter</code>. Now the output is as follows:</p><pre><code>Foo 0
Bar 0
Foo 1
Baz 0
Bar 1
Foo 2
Foo 3
Foo 4
Baz 1
Foo 5
</code></pre><p>This post isn&rsquo;t about a long discussion on the metaclass in Python or how <code>type</code> is a subclass of <code>type</code>, but simply serves as a reminder for the <em>very rare occasion</em> that I have to rock something other than <code>type</code>. For more information on the subject, a very nice write-up, <a href=https://jakevdp.github.io/blog/2012/12/01/a-primer-on-python-metaclasses/>A Primer on Python Metaclasses</a> by <a href=https://twitter.com/jakevdp>@jakevdp</a> is the way to go.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://bbengfort.github.io>Libelli</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>