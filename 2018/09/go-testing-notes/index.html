<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go Testing Notes | Libelli</title><meta name=keywords content><meta name=description content="In this post I&rsquo;m just going to maintain a list of notes for Go testing that I seem to commonly need to reference. It will also serve as an index for the posts related to testing that I have to commonly look up as well. Here is a quick listing of the table of contents:
 Basics Table Driven Tests Fixtures  Golden Files   Frameworks  No Framework Ginkgo & Gomega   Helpers  Temporary Directories   Sources and References  Basics Just a quick reminder of how to write tests, benchmarks, and examples."><meta name=author content="Benjamin Bengfort"><link rel=canonical href=https://bbengfort.github.io/2018/09/go-testing-notes/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d0c0348c2d0cff14148d0e347258519d8df2ce53ce5ac32c7bd9a549182cb8ae.css integrity="sha256-0MA0jC0M/xQUjQ40clhRnY3yzlPOWsMse9mlSRgsuK4=" rel="preload stylesheet" as=style><link rel=preload href=/icon.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://bbengfort.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bbengfort.github.io/icon.png><link rel=icon type=image/png sizes=32x32 href=https://bbengfort.github.io/icon.png><link rel=apple-touch-icon href=https://bbengfort.github.io/apple-touch-icon-precomposed.png><link rel=mask-icon href=https://bbengfort.github.io/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-8096804-11','auto');ga('send','pageview');}</script><meta property="og:title" content="Go Testing Notes"><meta property="og:description" content="In this post I&rsquo;m just going to maintain a list of notes for Go testing that I seem to commonly need to reference. It will also serve as an index for the posts related to testing that I have to commonly look up as well. Here is a quick listing of the table of contents:
 Basics Table Driven Tests Fixtures  Golden Files   Frameworks  No Framework Ginkgo & Gomega   Helpers  Temporary Directories   Sources and References  Basics Just a quick reminder of how to write tests, benchmarks, and examples."><meta property="og:type" content="article"><meta property="og:url" content="https://bbengfort.github.io/2018/09/go-testing-notes/"><meta property="og:image" content="https://bbengfort.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-09-22T09:58:12+00:00"><meta property="article:modified_time" content="2018-09-22T09:58:12+00:00"><meta property="og:site_name" content="Libelli"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bbengfort.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Go Testing Notes"><meta name=twitter:description content="In this post I&rsquo;m just going to maintain a list of notes for Go testing that I seem to commonly need to reference. It will also serve as an index for the posts related to testing that I have to commonly look up as well. Here is a quick listing of the table of contents:
 Basics Table Driven Tests Fixtures  Golden Files   Frameworks  No Framework Ginkgo & Gomega   Helpers  Temporary Directories   Sources and References  Basics Just a quick reminder of how to write tests, benchmarks, and examples."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://bbengfort.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Go Testing Notes","item":"https://bbengfort.github.io/2018/09/go-testing-notes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go Testing Notes","name":"Go Testing Notes","description":"In this post I\u0026rsquo;m just going to maintain a list of notes for Go testing that I seem to commonly need to reference. It will also serve as an index for the posts related to testing that I have to commonly look up as well. Here is a quick listing of the table of contents:\n Basics Table Driven Tests Fixtures  Golden Files   Frameworks  No Framework Ginkgo \u0026amp; Gomega   Helpers  Temporary Directories   Sources and References  Basics Just a quick reminder of how to write tests, benchmarks, and examples.","keywords":[],"articleBody":"In this post I’m just going to maintain a list of notes for Go testing that I seem to commonly need to reference. It will also serve as an index for the posts related to testing that I have to commonly look up as well. Here is a quick listing of the table of contents:\n Basics Table Driven Tests Fixtures  Golden Files   Frameworks  No Framework Ginkgo \u0026 Gomega   Helpers  Temporary Directories   Sources and References  Basics Just a quick reminder of how to write tests, benchmarks, and examples. A test is written as follows:\nfunc TestThing(t *testing.T) {} Benchmarks are written as follows:\nfunc BenchmarkThing(b *testing.B) { for i := 0; i b.N; i++ { // Do Thing  } } To run benchmarks, ensure you use the bench flag: go test -bench=. with the directory that contains the benchmarks specified. Examples are written as follows:\nfunc Examplething() { Thing() // Output:  // thing happened } Test assertions and descriptions are as follows (most commonly used):\n t.Error/t.Errorf: equivalent to t.Log followed by t.Fail, which means that the failure message is printed out, but the test continues running. t.Fatal/t.Fatalf: equivalent to t.Log followed by t.FailNow, which means the failure message is printed but the test is canceled at that point (all deferred calls will be executed after this step). t.Helper: marks the test is a helper, when printing file and line info, the function will be skipped. Usually used to make common assertions or perform setup or tear down. t.Skip/t.Skipif: marks the test as skipped, though the test will still fail if any Error was called before the skip.  Ref: Package testing\nTable Driven Tests Table driven tests use several language features including composite literals and anonymous structs to write related tests in a compact form. The most compact form of the tests looks like this:\nvar fibTests = []struct{ n int //input  expected int // expected result }{ {1, 1}, {2, 1}, {3, 2}, {4, 3}, {5, 5}, {6, 8}, {7, 13}, } Of course it is also possible to define an internal struct in the test package (if using pkg_test) for reusable test construction. Hooking it up is as simple as:\nfunc TestFig(t *testing.T) { for _, tt := range fibTests { actual := Fib(tt.n) if actual != expected { t.Errorf(\"Fig(%d): expected %d, actual %d\", tt.n, tt.expected, actual) } } } Ref: Dave Cheney — Writing table driven tests in Go\nFixtures When using the Go testing package, the test binary will be executed with its working directory set to the source directory of the package being tested. Additionally, the Go tool will ignore directories that start with a period, an underscore, or matches the word testdata. This means that you can create a directory called testdata and store fixtures there. You can then load data as follows:\nfunc loadFixture(t *testing.T, name string) []byte { path := filepath.Join(\"testdata\", name) bytes, err := ioutil.Readfile(path) if err != nil { t.Fatalf(\"could not open test fixture %s: %s\", name, err) } return bytes } Ref: Dave Cheney — Test fixtures in Go\nGolden Files When testing complicated or large output, you can save the data as an output file named .golden and provide a flag for updating it:\nvar update = flag.Bool(\"update\", false, \"update .golden files\") func TestSomething(t *testing.T) { actual := doSomething() golden := filepath.Join(\"testdata\", tc.Name+\".golden\") if *update { ioutil.WriteFile(golden, actual, 0644) } expected, _ := ioutil.ReadFile(golden) if !bytes.Equal(actual, expected) { // Fail!  } } Ref: Povilas Versockas — Go advanced testing tips \u0026 tricks\nFrameworks No Framework Ben Johnson makes a good argument for not using a testing framework. Go has a simple yet powerful testing framework. Frameworks are a barrier to entry for contributors to code. Frameworks require more dependencies to be fetched and managed. To reduce the verbosity, you can include simple test assertions as follows:\nfunc assert(tb testing.TB, condition bool, msg string) func ok(tb testing.TB, err error) func equals(tb testing.TB, exp, act interface{}) This way you can write tests as:\nfunc TestSomething(t *testing.T) { value, err := DoSomething() ok(t, err) equals(t, 100, value) } I certainly like the simplicity of this idea and on many of my small packages I simply write tests like this. However, in larger projects, it feels like test organization can quickly get out of control and I don’t know what I’ve tested and where.\nRef: Ben Johnson — Structuring Tests in Go Ref: Testing Functions for Go\nGinkgo \u0026 Gomega Many of my projects have started off using Ginkgo and Gomega for testing. Ginkgo provides BDD style testing to write expressive and well organized tests. Gomega provides a matching library for performing test-related assertions.\nTo bootstrap a test suite (after installing the libraries with go get) you would run ginkgo bootstrap. This creates the test suite which runs the tests. You can then generate tests by running ginkgo generate thing to create thing_test.go with the test stub already inside it:\npackage thing_test import ( . \"/path/to/thing\" . \"github.com/onsi/ginkgo\" . \"github.com/onsi/gomega\" ) var _ = Describe(\"Thing\", func() { var thing Thing BeforeEach(func() { thing = new(Thing) }) It(\"should do something\", func() { Ω(thing.Something()).Should(Succeed()) }) }) While I do like the use of this test framework, it’s primarily for the organization of the tests and the runner.\nHelpers Helper functions can be marked with t.Helper(), which excludes their line and signature information from the test error traceback. They can be used to do setup for the test case, unrelated error checks, and can even clean up after themselves!\nTemporary Directories Often, I need a temporary directory to store a database in or write files to. I can create the temporary directory with this helper function, which also returns a function to cleanup the temporary directories.\nconst tmpDirPrefix = \"mytests\" func tempDir(t *testing.T, name string) (path string, cleanup func()) { t.Helper() tmpDir, err = ioutil.TempDir(\"\", tmpDirPrefix) if err != nil { t.Fatalf(\"could not create temporary directory: %s\", err) } return filepath.Join(tmpDir, name), func() { err = os.RemoveAll(tmpDir) if err != nil { t.Errorf(\"could not remove temporary directory: %s\", err) } } } This can be used with the cleanup function pretty simply:\nfunc TestThing(t *testing.T) { dir, cleanup := tempDir(t, \"db\") defer cleanup() ... } Another version that I have in some of my tests creates a temporary directory for all of the tests, stored in a variable at the top level, any caller asking for a directory can create it, but it won’t be overridden if if already exists; then any test that cleans up will clean up that directory.\nSources and References  Package testing Dave Cheney — Writing table driven tests in Go Dave Cheney — Test fixtures in Go Ben Johnson — Structuring Tests in Go Povilas Versockas — Go advanced testing tips \u0026 tricks  Not related to testing, but saved for reference for a later godoc notes post:\n Elliot Chance — Godoc: Tips \u0026 Tricks Andrew Gerrand — Godoc: documenting Go code  ","wordCount":"1150","inLanguage":"en","datePublished":"2018-09-22T09:58:12Z","dateModified":"2018-09-22T09:58:12Z","author":{"@type":"Person","name":"Benjamin Bengfort"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bbengfort.github.io/2018/09/go-testing-notes/"},"publisher":{"@type":"Organization","name":"Libelli","logo":{"@type":"ImageObject","url":"https://bbengfort.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: #1d1e20;--entry: #2e2e33;--primary: rgba(255, 255, 255, 0.84);--secondary: rgba(255, 255, 255, 0.56);--tertiary: rgba(255, 255, 255, 0.16);--content: rgba(255, 255, 255, 0.74);--hljs-bg: #2e2e33;--code-bg: #37383e;--border: #333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://bbengfort.github.io accesskey=h title="Libelli (Alt + H)"><img src=/icon.png alt=logo aria-label=logo height=35>Libelli</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bbengfort.github.io/archive/ title=archive><span>archive</span></a></li><li><a href=https://bbengfort.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bbengfort.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://bbengfort.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Go Testing Notes</h1><div class=post-meta>September 22, 2018&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Benjamin Bengfort</div></header><div class=post-content><p>In this post I&rsquo;m just going to maintain a list of notes for Go testing that I seem to commonly need to reference. It will also serve as an index for the posts related to testing that I have to commonly look up as well. Here is a quick listing of the table of contents:</p><ul><li><a href=#basics>Basics</a></li><li><a href=#table-driven-tests>Table Driven Tests</a></li><li><a href=#fixtures>Fixtures</a><ul><li><a href=#golden-files>Golden Files</a></li></ul></li><li><a href=#frameworks>Frameworks</a><ul><li><a href=#no-framework>No Framework</a></li><li><a href=#ginkgo--gomega>Ginkgo & Gomega</a></li></ul></li><li><a href=#helpers>Helpers</a><ul><li><a href=#temporary-directories>Temporary Directories</a></li></ul></li><li><a href=#sources-and-references>Sources and References</a></li></ul><h2 id=basics>Basics<a hidden class=anchor aria-hidden=true href=#basics>#</a></h2><p>Just a quick reminder of how to write tests, benchmarks, and examples. A test is written as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestThing</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {}
</code></pre></div><p>Benchmarks are written as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>BenchmarkThing</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>N</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
        <span style=color:#75715e>// Do Thing
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>To run benchmarks, ensure you use the bench flag: <code>go test -bench=.</code> with the directory that contains the benchmarks specified. Examples are written as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Examplething</span>() {
    <span style=color:#a6e22e>Thing</span>()
    <span style=color:#75715e>// Output:
</span><span style=color:#75715e></span>    <span style=color:#75715e>// thing happened
</span><span style=color:#75715e></span>}
</code></pre></div><p>Test assertions and descriptions are as follows (most commonly used):</p><ul><li><code>t.Error</code>/<code>t.Errorf</code>: equivalent to <code>t.Log</code> followed by <code>t.Fail</code>, which means that the failure message is printed out, but the test continues running.</li><li><code>t.Fatal</code>/<code>t.Fatalf</code>: equivalent to <code>t.Log</code> followed by <code>t.FailNow</code>, which means the failure message is printed but the test is canceled at that point (all deferred calls will be executed after this step).</li><li><code>t.Helper</code>: marks the test is a helper, when printing file and line info, the function will be skipped. Usually used to make common assertions or perform setup or tear down.</li><li><code>t.Skip</code>/<code>t.Skipif</code>: marks the test as skipped, though the test will still fail if any <code>Error</code> was called before the skip.</li></ul><p>Ref: <a href=https://golang.org/pkg/testing/>Package testing</a></p><h2 id=table-driven-tests>Table Driven Tests<a hidden class=anchor aria-hidden=true href=#table-driven-tests>#</a></h2><p>Table driven tests use several language features including composite literals and anonymous structs to write related tests in a compact form. The most compact form of the tests looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fibTests</span> = []<span style=color:#66d9ef>struct</span>{
    <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>        <span style=color:#75715e>//input
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>expected</span> <span style=color:#66d9ef>int</span> <span style=color:#75715e>// expected result
</span><span style=color:#75715e></span>}{
    {<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>}, {<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>}, {<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>}, {<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>3</span>}, {<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>5</span>}, {<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>8</span>}, {<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>13</span>},
}
</code></pre></div><p>Of course it is also possible to define an internal struct in the test package (if using <code>pkg_test</code>) for reusable test construction. Hooking it up is as simple as:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestFig</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>fibTests</span> {
        <span style=color:#a6e22e>actual</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Fib</span>(<span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>n</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>actual</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>expected</span> {
            <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Fig(%d): expected %d, actual %d&#34;</span>, <span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>expected</span>, <span style=color:#a6e22e>actual</span>)
        }
    }
}
</code></pre></div><p>Ref: <a href=https://dave.cheney.net/2013/06/09/writing-table-driven-tests-in-go>Dave Cheney — Writing table driven tests in Go</a></p><h2 id=fixtures>Fixtures<a hidden class=anchor aria-hidden=true href=#fixtures>#</a></h2><p>When using the Go testing package, the test binary will be executed with its working directory set to the source directory of the package being tested. Additionally, the Go tool will ignore directories that start with a period, an underscore, or matches the word <code>testdata</code>. This means that you can create a directory called <code>testdata</code> and store fixtures there. You can then load data as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>loadFixture</span>(<span style=color:#a6e22e>t</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>) []<span style=color:#66d9ef>byte</span> {
    <span style=color:#a6e22e>path</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#e6db74>&#34;testdata&#34;</span>, <span style=color:#a6e22e>name</span>)
    <span style=color:#a6e22e>bytes</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>Readfile</span>(<span style=color:#a6e22e>path</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;could not open test fixture %s: %s&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>err</span>)
    }
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>bytes</span>
}
</code></pre></div><p>Ref: <a href=https://dave.cheney.net/2016/05/10/test-fixtures-in-go>Dave Cheney — Test fixtures in Go</a></p><h3 id=golden-files>Golden Files<a hidden class=anchor aria-hidden=true href=#golden-files>#</a></h3><p>When testing complicated or large output, you can save the data as an output file named <code>.golden</code> and provide a flag for updating it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>update</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Bool</span>(<span style=color:#e6db74>&#34;update&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;update .golden files&#34;</span>)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestSomething</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>actual</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>doSomething</span>()

    <span style=color:#a6e22e>golden</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#e6db74>&#34;testdata&#34;</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>Name</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;.golden&#34;</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>update</span> {
        <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>WriteFile</span>(<span style=color:#a6e22e>golden</span>, <span style=color:#a6e22e>actual</span>, <span style=color:#ae81ff>0644</span>)
    }

    <span style=color:#a6e22e>expected</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>golden</span>)
    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>actual</span>, <span style=color:#a6e22e>expected</span>) {
        <span style=color:#75715e>// Fail!
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>Ref: <a href=https://medium.com/@povilasve/go-advanced-tips-tricks-a872503ac859>Povilas Versockas — Go advanced testing tips & tricks</a></p><h2 id=frameworks>Frameworks<a hidden class=anchor aria-hidden=true href=#frameworks>#</a></h2><h3 id=no-framework>No Framework<a hidden class=anchor aria-hidden=true href=#no-framework>#</a></h3><p>Ben Johnson makes a good argument for not using a testing framework. Go has a simple yet powerful testing framework. Frameworks are a barrier to entry for contributors to code. Frameworks require more dependencies to be fetched and managed. To reduce the verbosity, you can include simple test assertions as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>assert</span>(<span style=color:#a6e22e>tb</span> <span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>TB</span>, <span style=color:#a6e22e>condition</span> <span style=color:#66d9ef>bool</span>, <span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>)
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ok</span>(<span style=color:#a6e22e>tb</span> <span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>TB</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>)
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>equals</span>(<span style=color:#a6e22e>tb</span> <span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>TB</span>, <span style=color:#a6e22e>exp</span>, <span style=color:#a6e22e>act</span> <span style=color:#66d9ef>interface</span>{})
</code></pre></div><p>This way you can write tests as:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestSomething</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DoSomething</span>()
    <span style=color:#a6e22e>ok</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)
    <span style=color:#a6e22e>equals</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>value</span>)
}
</code></pre></div><p>I certainly like the simplicity of this idea and on many of my small packages I simply write tests like this. However, in larger projects, it feels like test organization can quickly get out of control and I don&rsquo;t know what I&rsquo;ve tested and where.</p><p>Ref: <a href=https://medium.com/@benbjohnson/structuring-tests-in-go-46ddee7a25c>Ben Johnson — Structuring Tests in Go</a>
Ref: <a href=https://github.com/benbjohnson/testing>Testing Functions for Go</a></p><h3 id=ginkgo--gomega>Ginkgo & Gomega<a hidden class=anchor aria-hidden=true href=#ginkgo--gomega>#</a></h3><p>Many of my projects have started off using <a href=http://onsi.github.io/ginkgo/>Ginkgo</a> and <a href=http://onsi.github.io/gomega/>Gomega</a> for testing. Ginkgo provides BDD style testing to write expressive and well organized tests. Gomega provides a matching library for performing test-related assertions.</p><p>To bootstrap a test suite (after installing the libraries with <code>go get</code>) you would run <code>ginkgo bootstrap</code>. This creates the test suite which runs the tests. You can then generate tests by running <code>ginkgo generate thing</code> to create <code>thing_test.go</code> with the test stub already inside it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>thing_test</span>

<span style=color:#f92672>import</span> (
    . <span style=color:#e6db74>&#34;/path/to/thing&#34;</span>
    . <span style=color:#e6db74>&#34;github.com/onsi/ginkgo&#34;</span>
    . <span style=color:#e6db74>&#34;github.com/onsi/gomega&#34;</span>
)

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>Describe</span>(<span style=color:#e6db74>&#34;Thing&#34;</span>, <span style=color:#66d9ef>func</span>() {

    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>thing</span> <span style=color:#a6e22e>Thing</span>

    <span style=color:#a6e22e>BeforeEach</span>(<span style=color:#66d9ef>func</span>() {
        <span style=color:#a6e22e>thing</span> = new(<span style=color:#a6e22e>Thing</span>)
    })

    <span style=color:#a6e22e>It</span>(<span style=color:#e6db74>&#34;should do something&#34;</span>, <span style=color:#66d9ef>func</span>() {
        <span style=color:#a6e22e>Ω</span>(<span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>Something</span>()).<span style=color:#a6e22e>Should</span>(<span style=color:#a6e22e>Succeed</span>())
    })

})
</code></pre></div><p>While I do like the use of this test framework, it&rsquo;s primarily for the organization of the tests and the runner.</p><h2 id=helpers>Helpers<a hidden class=anchor aria-hidden=true href=#helpers>#</a></h2><p>Helper functions can be marked with <code>t.Helper()</code>, which excludes their line and signature information from the test error traceback. They can be used to do setup for the test case, unrelated error checks, and can even clean up after themselves!</p><h3 id=temporary-directories>Temporary Directories<a hidden class=anchor aria-hidden=true href=#temporary-directories>#</a></h3><p>Often, I need a temporary directory to store a database in or write files to. I can create the temporary directory with this helper function, which also returns a function to cleanup the temporary directories.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tmpDirPrefix</span> = <span style=color:#e6db74>&#34;mytests&#34;</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>tempDir</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>cleanup</span> <span style=color:#66d9ef>func</span>()) {
    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Helper</span>()

    <span style=color:#a6e22e>tmpDir</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>TempDir</span>(<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>tmpDirPrefix</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;could not create temporary directory: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
    }

    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>tmpDir</span>, <span style=color:#a6e22e>name</span>), <span style=color:#66d9ef>func</span>() {
        <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>RemoveAll</span>(<span style=color:#a6e22e>tmpDir</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
            <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not remove temporary directory: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
        }
    }
}
</code></pre></div><p>This can be used with the cleanup function pretty simply:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestThing</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>dir</span>, <span style=color:#a6e22e>cleanup</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tempDir</span>(<span style=color:#a6e22e>t</span>, <span style=color:#e6db74>&#34;db&#34;</span>)
    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cleanup</span>()

    <span style=color:#f92672>...</span>
}
</code></pre></div><p>Another version that I have in some of my tests creates a temporary directory for all of the tests, stored in a variable at the top level, any caller asking for a directory can create it, but it won&rsquo;t be overridden if if already exists; then any test that cleans up will clean up that directory.</p><h2 id=sources-and-references>Sources and References<a hidden class=anchor aria-hidden=true href=#sources-and-references>#</a></h2><ul><li><a href=https://golang.org/pkg/testing/>Package testing</a></li><li><a href=https://dave.cheney.net/2013/06/09/writing-table-driven-tests-in-go>Dave Cheney — Writing table driven tests in Go</a></li><li><a href=https://dave.cheney.net/2016/05/10/test-fixtures-in-go>Dave Cheney — Test fixtures in Go</a></li><li><a href=https://medium.com/@benbjohnson/structuring-tests-in-go-46ddee7a25c>Ben Johnson — Structuring Tests in Go</a></li><li><a href=https://medium.com/@povilasve/go-advanced-tips-tricks-a872503ac859>Povilas Versockas — Go advanced testing tips & tricks</a></li></ul><p>Not related to testing, but saved for reference for a later godoc notes post:</p><ul><li><a href=http://elliot.land/post/godoc-tips-tricks>Elliot Chance — Godoc: Tips & Tricks</a></li><li><a href=https://blog.golang.org/godoc-documenting-go-code>Andrew Gerrand — Godoc: documenting Go code</a></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://bbengfort.github.io>Libelli</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>