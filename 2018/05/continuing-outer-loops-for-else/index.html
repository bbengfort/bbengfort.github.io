<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Continuing Outer Loops with for/else | Libelli</title><meta name=keywords content><meta name=description content="When you have an outer and an inner loop, how do you continue the outer loop from a condition inside the inner loop? Consider the following code:
for i in range(10): for j in range(9): if i <= j: # break out of inner loop # continue outer loop print(i,j) # don't print unless inner loop completes, # e.g. outer loop is not continued print(&#34;inner complete!&#34;) Here, we want to print for all i ∈ [0,10) all numbers j ∈ [0,9) that are less than or equal to i and we want to print complete once we&rsquo;ve found an entire list of j that meets the criteria."><meta name=author content="Benjamin Bengfort"><link rel=canonical href=https://bbengfort.github.io/2018/05/continuing-outer-loops-for-else/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d0c0348c2d0cff14148d0e347258519d8df2ce53ce5ac32c7bd9a549182cb8ae.css integrity="sha256-0MA0jC0M/xQUjQ40clhRnY3yzlPOWsMse9mlSRgsuK4=" rel="preload stylesheet" as=style><link rel=preload href=/icon.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://bbengfort.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bbengfort.github.io/icon.png><link rel=icon type=image/png sizes=32x32 href=https://bbengfort.github.io/icon.png><link rel=apple-touch-icon href=https://bbengfort.github.io/apple-touch-icon-precomposed.png><link rel=mask-icon href=https://bbengfort.github.io/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-8096804-11','auto');ga('send','pageview');}</script><meta property="og:title" content="Continuing Outer Loops with for/else"><meta property="og:description" content="When you have an outer and an inner loop, how do you continue the outer loop from a condition inside the inner loop? Consider the following code:
for i in range(10): for j in range(9): if i <= j: # break out of inner loop # continue outer loop print(i,j) # don't print unless inner loop completes, # e.g. outer loop is not continued print(&#34;inner complete!&#34;) Here, we want to print for all i ∈ [0,10) all numbers j ∈ [0,9) that are less than or equal to i and we want to print complete once we&rsquo;ve found an entire list of j that meets the criteria."><meta property="og:type" content="article"><meta property="og:url" content="https://bbengfort.github.io/2018/05/continuing-outer-loops-for-else/"><meta property="og:image" content="https://bbengfort.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-05-17T09:02:43+00:00"><meta property="article:modified_time" content="2018-05-17T09:02:43+00:00"><meta property="og:site_name" content="Libelli"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bbengfort.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Continuing Outer Loops with for/else"><meta name=twitter:description content="When you have an outer and an inner loop, how do you continue the outer loop from a condition inside the inner loop? Consider the following code:
for i in range(10): for j in range(9): if i <= j: # break out of inner loop # continue outer loop print(i,j) # don't print unless inner loop completes, # e.g. outer loop is not continued print(&#34;inner complete!&#34;) Here, we want to print for all i ∈ [0,10) all numbers j ∈ [0,9) that are less than or equal to i and we want to print complete once we&rsquo;ve found an entire list of j that meets the criteria."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://bbengfort.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Continuing Outer Loops with for/else","item":"https://bbengfort.github.io/2018/05/continuing-outer-loops-for-else/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Continuing Outer Loops with for/else","name":"Continuing Outer Loops with for\/else","description":"When you have an outer and an inner loop, how do you continue the outer loop from a condition inside the inner loop? Consider the following code:\nfor i in range(10): for j in range(9): if i \u0026lt;= j: # break out of inner loop # continue outer loop print(i,j) # don\u0026#39;t print unless inner loop completes, # e.g. outer loop is not continued print(\u0026#34;inner complete!\u0026#34;) Here, we want to print for all i ∈ [0,10) all numbers j ∈ [0,9) that are less than or equal to i and we want to print complete once we\u0026rsquo;ve found an entire list of j that meets the criteria.","keywords":[],"articleBody":"When you have an outer and an inner loop, how do you continue the outer loop from a condition inside the inner loop? Consider the following code:\nfor i in range(10): for j in range(9): if i  j: # break out of inner loop # continue outer loop print(i,j) # don't print unless inner loop completes, # e.g. outer loop is not continued print(\"inner complete!\") Here, we want to print for all i ∈ [0,10) all numbers j ∈ [0,9) that are less than or equal to i and we want to print complete once we’ve found an entire list of j that meets the criteria. While this seems like a fairly contrived example, I’ve actually encountered this exact situation in several places in code this week, and I’ll provide a real example in a bit.\nMy first instinct simply uses a function to use return to do a “hard break” out of the loop. This allows us to short-circuit functionality by exiting the function, but doesn’t actually provide continue functionality, which is the goal in the above example. The technique does work, however, and in multi-loop situations is probably the best bet.\ndef inner(i): for j in range(9): if i  j: # Note if this was break, the print statement would execute return print(i,j) print(\"inner complete\") for i in range(10): inner(i) Much neater, however is using for/else. The else block fires iff the for loop it is connected with completes. This was very weird to me at first, I thought else should trigger if break. Think of it this way though:\n You’re searching through a list of things, for item in collection and you plan to break when you’ve found the item you’re looking for, else you do something if you exhaust the collection and didn’t find what you were looking for.\n Therefore we can code our loop as follows:\nfor i in range(10): for j in range(9): if i  j: break print(i,j) else: # Outer loop is continued continue print(\"inner complete!\") This is a little strange, because it is probably more appropriate to put our print in the else block, but this was the spec, continue the outer loop if the inner loop gets broken.\nHere’s a better example with date parsing:\n# Try to parse a timestamp with a bunch of formats for fmt in (JSON, PG, ISO, RFC, HUMAN): try: ts = datetime.strptime(ts, fmt) break except ValueError: continue else: # Could not parse with any of the formats required raise ValueError(\"could not parse timestamp\") Is this better or worse than the function version of this?\ndef parse_timestamp(ts): for fmt in (JSON, PG, ISO, RFC, HUMAN): try: return datetime.strptime(ts, fmt) except ValueError: continue raise ValueError(\"could not parse timestamp\") ts = parse_timestamp(ts) Let’s go to the benchmarks:\nSo basically, there is no meaningful difference, but depending on the context of implementation, using for/else may be a bit more meaningful or easy to test than having to implement another function.\nBenchmark code can be found here.\n","wordCount":"500","inLanguage":"en","datePublished":"2018-05-17T09:02:43Z","dateModified":"2018-05-17T09:02:43Z","author":{"@type":"Person","name":"Benjamin Bengfort"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bbengfort.github.io/2018/05/continuing-outer-loops-for-else/"},"publisher":{"@type":"Organization","name":"Libelli","logo":{"@type":"ImageObject","url":"https://bbengfort.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: #1d1e20;--entry: #2e2e33;--primary: rgba(255, 255, 255, 0.84);--secondary: rgba(255, 255, 255, 0.56);--tertiary: rgba(255, 255, 255, 0.16);--content: rgba(255, 255, 255, 0.74);--hljs-bg: #2e2e33;--code-bg: #37383e;--border: #333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://bbengfort.github.io accesskey=h title="Libelli (Alt + H)"><img src=/icon.png alt=logo aria-label=logo height=35>Libelli</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bbengfort.github.io/archive/ title=archive><span>archive</span></a></li><li><a href=https://bbengfort.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bbengfort.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://bbengfort.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Continuing Outer Loops with for/else</h1><div class=post-meta>May 17, 2018&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Benjamin Bengfort</div></header><div class=post-content><p>When you have an outer and an inner loop, how do you continue the outer loop from a condition inside the inner loop? Consider the following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>9</span>):
        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&lt;=</span> j:
            <span style=color:#75715e># break out of inner loop</span>
            <span style=color:#75715e># continue outer loop</span>
        <span style=color:#66d9ef>print</span>(i,j)

    <span style=color:#75715e># don&#39;t print unless inner loop completes,</span>
    <span style=color:#75715e># e.g. outer loop is not continued</span>
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;inner complete!&#34;</span>)
</code></pre></div><p>Here, we want to print for all <code>i</code> ∈ <code>[0,10)</code> all numbers <code>j</code> ∈ <code>[0,9)</code> that are less than or equal to i and we want to print complete once we&rsquo;ve found an entire list of <code>j</code> that meets the criteria. While this seems like a fairly contrived example, I&rsquo;ve actually encountered this exact situation in several places in code this week, and I&rsquo;ll provide a real example in a bit.</p><p>My first instinct simply uses a function to use <code>return</code> to do a &ldquo;hard break&rdquo; out of the loop. This allows us to short-circuit functionality by exiting the function, but doesn&rsquo;t actually provide <code>continue</code> functionality, which is the goal in the above example. The technique does work, however, and in multi-loop situations is probably the best bet.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>inner</span>(i):
    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>9</span>):
        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&lt;=</span> j:
            <span style=color:#75715e># Note if this was break, the print statement would execute</span>
            <span style=color:#66d9ef>return</span>
        <span style=color:#66d9ef>print</span>(i,j)

    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;inner complete&#34;</span>)

<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
    inner(i)
</code></pre></div><p>Much neater, however is using <code>for/else</code>. The <code>else</code> block fires iff the for loop it is connected with <em>completes</em>. This was very weird to me at first, I thought <code>else</code> should trigger if <code>break</code>. Think of it this way though:</p><blockquote><p>You&rsquo;re searching through a list of things, <code>for item in collection</code> and you plan to <code>break</code> when you&rsquo;ve found the item you&rsquo;re looking for, <code>else</code> you do something if you exhaust the collection and didn&rsquo;t find what you were looking for.</p></blockquote><p>Therefore we can code our loop as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>9</span>):
        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&lt;=</span> j:
            <span style=color:#66d9ef>break</span>
        <span style=color:#66d9ef>print</span>(i,j)
    <span style=color:#66d9ef>else</span>:
        <span style=color:#75715e># Outer loop is continued</span>
        <span style=color:#66d9ef>continue</span>

    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;inner complete!&#34;</span>)
</code></pre></div><p>This is a little strange, because it is probably more appropriate to put our <code>print</code> in the <code>else</code> block, but this was the spec, continue the outer loop if the inner loop gets broken.</p><p>Here&rsquo;s a better example with date parsing:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Try to parse a timestamp with a bunch of formats</span>
<span style=color:#66d9ef>for</span> fmt <span style=color:#f92672>in</span> (JSON, PG, ISO, RFC, HUMAN):
    <span style=color:#66d9ef>try</span>:
        ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(ts, fmt)
        <span style=color:#66d9ef>break</span>
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
        <span style=color:#66d9ef>continue</span>
<span style=color:#66d9ef>else</span>:
    <span style=color:#75715e># Could not parse with any of the formats required</span>
    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;could not parse timestamp&#34;</span>)
</code></pre></div><p>Is this better or worse than the function version of this?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_timestamp</span>(ts):
    <span style=color:#66d9ef>for</span> fmt <span style=color:#f92672>in</span> (JSON, PG, ISO, RFC, HUMAN):
        <span style=color:#66d9ef>try</span>:
            <span style=color:#66d9ef>return</span> datetime<span style=color:#f92672>.</span>strptime(ts, fmt)
        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
            <span style=color:#66d9ef>continue</span>

    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;could not parse timestamp&#34;</span>)

ts <span style=color:#f92672>=</span> parse_timestamp(ts)
</code></pre></div><p>Let&rsquo;s go to the benchmarks:</p><p><img loading=lazy src=/images/2018-05-17-benchmark.png alt="Benchmark for/else vs. function date parsing"></p><p>So basically, there is no meaningful difference, but depending on the context of implementation, using <code>for/else</code> may be a bit more meaningful or easy to test than having to implement another function.</p><p>Benchmark code can be found <a href=https://gist.github.com/bbengfort/bc7f985b2b18d789a30d8a52145aed8b>here</a>.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://bbengfort.github.io>Libelli</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>